var u=Object.defineProperty;var g=(n,t,e)=>t in n?u(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>(g(n,typeof t!="symbol"?t+"":t,e),e);const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function e(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=e(o);fetch(o.href,a)}};p();const f=10;class _{constructor(t,e){s(this,"_rotation",Math.floor(Math.random()*4));s(this,"angle",Math.PI/2*this._rotation);s(this,"rotatingCount",0);s(this,"_isRotating",!1);s(this,"neighbors",new Map);s(this,"_hasRotated",!1);this.x=t,this.y=e}get rotation(){return this._rotation}get isRotating(){return this._isRotating}get hasRotated(){return this._hasRotated}init(){this._rotation=Math.floor(Math.random()*4),this.angle=Math.PI/2*this._rotation,this._isRotating=!1,this.rotatingCount=0}appendNeighbor(t,e){this.neighbors.set(t,e)}rotate(){this._isRotating||(this._isRotating=!0,this.rotatingCount=0)}rotateNeighbors(){this.neighbors.forEach((t,e)=>{(e==="top"&&(t._rotation===1||t._rotation===2)&&(this._rotation===0||this._rotation===3)||e==="right"&&(t._rotation===2||t._rotation===3)&&(this._rotation===0||this._rotation===1)||e==="bottom"&&(t._rotation===0||t._rotation===3)&&(this._rotation===1||this._rotation===2)||e==="left"&&(t._rotation===0||t._rotation===1)&&(this._rotation===2||this._rotation===3))&&t.rotate()})}update(){this._isRotating&&(this.angle=(this.angle+Math.PI/20)%(Math.PI*2),++this.rotatingCount==10&&(this._isRotating=!1,this._rotation=(this._rotation+1)%4,this._hasRotated=!0))}updateNeighbors(){this._hasRotated&&(this.rotateNeighbors(),this._hasRotated=!1)}draw(t){const e=f/2;t.save(),t.fillStyle="#ddd",t.strokeStyle=this._rotation===0?"blue":this._rotation===1?"red":this._rotation===2?"green":"orange",t.lineWidth=2,t.translate(this.x+e,this.y+e),t.rotate(this.angle),this.isRotating&&(t.beginPath(),t.arc(0,0,e,0,Math.PI*2),t.fill()),t.beginPath(),t.moveTo(0,-e),t.lineTo(0,0),t.lineTo(e,0),t.stroke(),t.restore()}}const h=50,r=f*h,c=class{constructor(t){s(this,"context");s(this,"bufferCanvas");s(this,"bufferContext");s(this,"canvasRect");s(this,"parts");s(this,"timer");this.canvas=t,this.context=t.getContext("2d"),this.canvasRect=t.getBoundingClientRect(),this.bufferCanvas=document.createElement("canvas"),this.bufferContext=this.bufferCanvas.getContext("2d")}start(){this.canvas.width=this.canvas.height=r,this.bufferCanvas.width=this.bufferCanvas.height=r,this.canvas.addEventListener("mousedown",this.onClick.bind(this)),this.parts=Array.from(Array(h),(t,e)=>Array.from(Array(h),(i,o)=>new _(o*f,e*f)));for(let t=0;t<h;t++)for(let e=0;e<h;e++){const i=this.parts[t][e];t>0&&i.appendNeighbor("top",this.parts[t-1][e]),e<h-1&&i.appendNeighbor("right",this.parts[t][e+1]),t<h-1&&i.appendNeighbor("bottom",this.parts[t+1][e]),e>0&&i.appendNeighbor("left",this.parts[t][e-1])}this.timer=setInterval(this.update.bind(this),1e3/60),console.log("chain game started!")}reset(){var t;for(const e of(t=this.parts)!=null?t:[])for(const i of e)i.init();this.draw()}end(){clearInterval(this.timer)}update(){var t,e;for(const i of(t=this.parts)!=null?t:[])for(const o of i)o.update();this.playSound();for(const i of(e=this.parts)!=null?e:[])for(const o of i)o.updateNeighbors();this.draw()}playSound(){var e;const t=[0,0,0,0];for(const i of(e=this.parts)!=null?e:[])for(const o of i)o.hasRotated&&t[o.rotation]++;t.forEach((i,o)=>{if(i>0){const{gain:a}=c.gainNodes[o];a.value=Math.min(.008+i*.002,.1),setTimeout(()=>a.value=0,100)}})}draw(){var t;this.context.clearRect(0,0,r,r),this.bufferContext.clearRect(0,0,r,r);for(const e of(t=this.parts)!=null?t:[])for(const i of e)i.draw(this.bufferContext);this.context.drawImage(this.bufferCanvas,0,0,r,r)}onClick(t){var o;const e=Math.floor((t.clientX-this.canvasRect.x)/f),i=Math.floor((t.clientY-this.canvasRect.y)/f);(o=this.parts)==null||o[i][e].rotate()}};let l=c;s(l,"audioCtx",new AudioContext),s(l,"gainNodes",new Array(4).fill(0).map((t,e)=>{const i=c.audioCtx.createGain();i.gain.value=0,i.connect(c.audioCtx.destination);const o=new OscillatorNode(c.audioCtx);return o.type="sine",o.frequency.value=300+e*100,o.connect(i),o.start(),i}));function m(){const n=document.getElementById("canvas"),t=new l(n);t.start(),document.getElementById("reset").addEventListener("click",t.reset.bind(t))}m();
